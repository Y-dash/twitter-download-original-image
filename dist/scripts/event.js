"use strict";var CONTEXT_ID="twitter-download-original-image";function callDownload(a){a.searchParams.set("name","orig"),"webp"===a.searchParams.get("format")?(a.searchParams.set("format","jpg"),fetch(a.toString()).then(function(e){e.ok||a.searchParams.set("format","png"),download(a)})):download(a)}function download(e){chrome.downloads.download({url:e.toString(),filename:e.pathname.replace("/media/","")+"_"+e.searchParams.get("name")+"."+e.searchParams.get("format")})}chrome.runtime.onInstalled.addListener(function(){chrome.contextMenus.removeAll(function(){chrome.contextMenus.create({type:"normal",id:CONTEXT_ID,title:"画像をオリジナルサイズで保存",contexts:["image"],targetUrlPatterns:["*://pbs.twimg.com/media/*"]})})}),chrome.contextMenus.onClicked.addListener(function(e){e.srcUrl&&e.menuItemId===CONTEXT_ID&&callDownload(new URL(e.srcUrl))});