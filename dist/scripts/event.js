"use strict";var CONTEXT_ID="download-original-image",isCreatedContextMenu=!1;function init(){isCreatedContextMenu||(chrome.contextMenus.create({type:"normal",id:CONTEXT_ID,title:"元画像を保存",contexts:["image"],targetUrlPatterns:["*://pbs.twimg.com/media/*"]}),isCreatedContextMenu=!0)}function download(e){var t=replaceUrlWithBiggest(e),r=makeFileNameFromUrl(t);chrome.downloads.download({url:t,filename:r})}function replaceUrlWithBiggest(e){return-1!==e.indexOf(":orig")||getSrcExist(e=-1!==e.indexOf("?format=")?e.replace("?format=",".").split("&name=")[0]+=":orig":(t=e.split(":"))[0]+":"+t[1]+":orig")||getSrcExist(e=e.replace(":orig",":large"))||(e=e.replace(":large","")),e;var t}function getSrcExist(e){var t=new XMLHttpRequest;return t.open("GET",e.toString(),!1),t.send(),200===t.status||500===t.status}function makeFileNameFromUrl(e){var t=e.substr(e.lastIndexOf("/")+1).split("."),r=t[1].split(":");return t[0]+"_"+r[1]+"."+r[0]}chrome.runtime.onInstalled.addListener(init),chrome.runtime.onStartup.addListener(init),chrome.contextMenus.onClicked.addListener(function(e){e.srcUrl&&e.menuItemId===CONTEXT_ID&&download(e.srcUrl)});