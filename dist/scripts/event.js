"use strict";var CONTEXT_ID="twitter-download-original-image.y-dash.net",isCreatedContextMenu=!1;function init(){isCreatedContextMenu||(chrome.contextMenus.create({type:"normal",id:CONTEXT_ID,title:"元画像を保存",contexts:["image"],targetUrlPatterns:["*://pbs.twimg.com/media/*"]}),isCreatedContextMenu=!0)}function download(e){var t=replaceUrlWithBiggest(e),n=makeFileNameFromUrl(t);chrome.downloads.download({url:t.toString(),filename:n})}function replaceUrlWithBiggest(e){var t=e.toString();return-1!==t.indexOf("=orig")?e:(t=t.replace(/name=.*$/,"name=orig"),e=new URL(t))}function makeFileNameFromUrl(e){var t;return((null===(t=e.toString().match(/media\/(.*)\?/))||void 0===t?void 0:t[1])||"downloadFile")+"_"+e.searchParams.get("name")+"."+e.searchParams.get("format")}chrome.runtime.onInstalled.addListener(init),chrome.runtime.onStartup.addListener(init),chrome.contextMenus.onClicked.addListener(function(e){e.srcUrl&&e.menuItemId===CONTEXT_ID&&download(new URL(e.srcUrl))});